class Solution {
public:
    int openLock(vector<string>& deadends, string target) {

        unordered_set<string> dead(deadends.begin(), deadends.end());
        unordered_set<string> visited;

        // If start is deadend
        if (dead.count("0000")) return -1;

        queue<string> q;
        q.push("0000");
        visited.insert("0000");

        int steps = 0;

        while (!q.empty()) {
            int size = q.size();

            while (size--) {
                string curr = q.front();
                q.pop();

                // If target reached
                if (curr == target)
                    return steps;

                // Try rotating each wheel
                for (int i = 0; i < 4; i++) {
                    char c = curr[i];

                    // Rotate forward
                    curr[i] = (c == '9') ? '0' : c + 1;
                    if (!dead.count(curr) && !visited.count(curr)) {
                        visited.insert(curr);
                        q.push(curr);
                    }

                    // Rotate backward
                    curr[i] = (c == '0') ? '9' : c - 1;
                    if (!dead.count(curr) && !visited.count(curr)) {
                        visited.insert(curr);
                        q.push(curr);
                    }

                    // Restore original digit
                    curr[i] = c;
                }
            }
            steps++;
        }

        return -1;
    }
};
